generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ResearchStatus {
  DRAFT
  QUEUED
  RUNNING
  COMPLETED
  FAILED
}

enum CoInvestorResearchStatus {
  DRAFT
  QUEUED
  RUNNING
  COMPLETED
  FAILED
}

enum CoInvestorInteractionType {
  MEETING
  EMAIL
  CALL
  EVENT
  INTRO
  NOTE
}

enum NextActionStatus {
  OPEN
  IN_PROGRESS
  BLOCKED
  DONE
  CANCELLED
}

enum NextActionPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum CompanyType {
  STARTUP
  SPIN_OUT
  DENOVO
}

enum CompanyPrimaryCategory {
  PATIENT_ACCESS_AND_GROWTH
  CARE_DELIVERY_TECH_ENABLED_SERVICES
  CLINICAL_WORKFLOW_AND_PRODUCTIVITY
  REVENUE_CYCLE_AND_FINANCIAL_OPERATIONS
  VALUE_BASED_CARE_AND_POPULATION_HEALTH_ENABLEMENT
  AI_ENABLED_AUTOMATION_AND_DECISION_SUPPORT
  DATA_PLATFORM_INTEROPERABILITY_AND_INTEGRATION
  REMOTE_PATIENT_MONITORING_AND_CONNECTED_DEVICES
  DIAGNOSTICS_IMAGING_AND_TESTING_ENABLEMENT
  PHARMACY_AND_MEDICATION_ENABLEMENT
  SUPPLY_CHAIN_PROCUREMENT_AND_ASSET_OPERATIONS
  SECURITY_PRIVACY_AND_COMPLIANCE_INFRASTRUCTURE
  PROVIDER_EXPERIENCE_AND_DEVELOPMENT
  OTHER
}

enum CompanyDeclineReason {
  PRODUCT
  INSUFFICIENT_ROI
  HIGHLY_COMPETITIVE_LANDSCAPE
  OUT_OF_INVESTMENT_THESIS_SCOPE
  TOO_EARLY
  TOO_MATURE_FOR_SEED_INVESTMENT
  LACKS_PROOF_POINTS
  INSUFFICIENT_TAM
  TEAM
  HEALTH_SYSTEM_BUYING_PROCESS
  WORKFLOW_FRICTION
  OTHER
}

enum CompanyIntakeStatus {
  NOT_SCHEDULED
  SCHEDULED
  COMPLETED
  SCREENING_EVALUATION
}

enum CompanyLeadSourceType {
  HEALTH_SYSTEM
  OTHER
}

enum CompanyHealthSystemRelationship {
  CUSTOMER
  SPIN_OUT_PARTNER
  INVESTOR_PARTNER
  OTHER
}

enum CompanyCoInvestorRelationship {
  INVESTOR
  PARTNER
  OTHER
}

enum CompanyPipelinePhase {
  INTAKE
  DECLINED
  VENTURE_STUDIO_NEGOTIATION
  SCREENING
  LOI_COLLECTION
  COMMERCIAL_NEGOTIATION
  PORTFOLIO_GROWTH
}

enum CompanyIntakeDecision {
  PENDING
  ADVANCE_TO_NEGOTIATION
  DECLINE
}

enum CompanyDocumentType {
  INTAKE_REPORT
  SCREENING_REPORT
  TERM_SHEET
  VENTURE_STUDIO_CONTRACT
  LOI
  COMMERCIAL_CONTRACT
  OTHER
}

enum EntityKind {
  HEALTH_SYSTEM
  CO_INVESTOR
  COMPANY
}

enum CompanyOpportunityType {
  VENTURE_STUDIO_SERVICES
  S1_TERM_SHEET
  COMMERCIAL_CONTRACT
  PROSPECT_PURSUIT
}

enum CompanyOpportunityStage {
  IDENTIFIED
  QUALIFICATION
  PROPOSAL
  NEGOTIATION
  LEGAL
  CLOSED_WON
  CLOSED_LOST
  ON_HOLD
}

enum CompanyScreeningEventType {
  WEBINAR
  INDIVIDUAL_SESSION
  OTHER
}

enum CompanyScreeningAttendanceStatus {
  INVITED
  ATTENDED
  DECLINED
  NO_SHOW
}

enum CompanyLoiStatus {
  NOT_STARTED
  PENDING
  NEGOTIATING
  SIGNED
  DECLINED
}

enum CompanyScreeningFeedbackSentiment {
  POSITIVE
  MIXED
  NEUTRAL
  NEGATIVE
}

enum CompanyScreeningCellField {
  RELEVANT_FEEDBACK
  STATUS_UPDATE
}

enum CompanyScreeningSurveySessionStatus {
  DRAFT
  LIVE
  CLOSED
}

enum CompanyFundraiseStatus {
  PLANNED
  OPEN
  CLOSED
  CANCELLED
}

model HealthSystem {
  id                          String         @id @default(cuid())
  name                        String
  legalName                   String?
  website                     String?
  headquartersCity            String?
  headquartersState           String?
  headquartersCountry         String?
  netPatientRevenueUsd        Decimal?       @db.Decimal(16, 2)
  isLimitedPartner            Boolean        @default(false)
  limitedPartnerInvestmentUsd Decimal?       @db.Decimal(16, 2)
  isAllianceMember            Boolean        @default(false)
  hasInnovationTeam           Boolean?
  hasVentureTeam              Boolean?
  ventureTeamSummary          String?
  researchStatus              ResearchStatus @default(DRAFT)
  researchNotes               String?
  researchError               String?
  researchUpdatedAt           DateTime?
  createdAt                   DateTime       @default(now())
  updatedAt                   DateTime       @updatedAt

  executives                           Executive[]
  venturePartners                      VenturePartner[]
  investments                          HealthSystemInvestment[]
  researchJobs                         HealthSystemResearchJob[]
  companyLeadSources                   Company[]                              @relation("CompanyLeadSourceHealthSystem")
  companyHealthSystemLinks             CompanyHealthSystemLink[]
  contactLinks                         ContactHealthSystem[]
  companyOpportunities                 CompanyOpportunity[]
  companyScreeningParticipants         CompanyScreeningParticipant[]
  companyLois                          CompanyLoi[]
  companyScreeningDocuments            CompanyScreeningDocument[]
  companyScreeningQuantitativeFeedback CompanyScreeningQuantitativeFeedback[]
  companyScreeningQualitativeFeedback  CompanyScreeningQualitativeFeedback[]
  companyScreeningCellChanges          CompanyScreeningCellChange[]
  companyScreeningSurveySubmissions    CompanyScreeningSurveySubmission[]

  @@index([name])
  @@index([isAllianceMember])
  @@index([isLimitedPartner])
  @@index([researchStatus])
  @@index([website])
  @@index([headquartersCity, headquartersState, headquartersCountry])
}

model Executive {
  id             String   @id @default(cuid())
  healthSystemId String
  name           String
  title          String?
  linkedinUrl    String?
  createdAt      DateTime @default(now())

  healthSystem HealthSystem @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)

  @@index([healthSystemId])
}

model VenturePartner {
  id             String   @id @default(cuid())
  healthSystemId String
  name           String
  coInvestorId   String?
  title          String?
  profileUrl     String?
  createdAt      DateTime @default(now())

  healthSystem HealthSystem @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)
  coInvestor   CoInvestor?  @relation(fields: [coInvestorId], references: [id], onDelete: SetNull)

  @@index([healthSystemId])
  @@index([coInvestorId])
}

model HealthSystemInvestment {
  id                   String    @id @default(cuid())
  healthSystemId       String
  portfolioCompanyName String
  companyId            String?
  investmentAmountUsd  Decimal?  @db.Decimal(16, 2)
  investmentDate       DateTime?
  leadPartnerName      String?
  sourceUrl            String?
  createdAt            DateTime  @default(now())

  healthSystem HealthSystem @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)
  company      Company?     @relation(fields: [companyId], references: [id], onDelete: SetNull)

  @@index([healthSystemId])
  @@index([companyId])
  @@index([portfolioCompanyName])
}

model HealthSystemResearchJob {
  id              String         @id @default(cuid())
  healthSystemId  String
  status          ResearchStatus @default(QUEUED)
  searchName      String
  selectedCity    String?
  selectedState   String?
  selectedCountry String?
  selectedWebsite String?
  startedAt       DateTime?
  completedAt     DateTime?
  errorMessage    String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  healthSystem HealthSystem @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)

  @@index([status, createdAt])
  @@index([healthSystemId, createdAt])
}

model CoInvestor {
  id                  String                   @id @default(cuid())
  name                String
  legalName           String?
  website             String?
  headquartersCity    String?
  headquartersState   String?
  headquartersCountry String?
  isSeedInvestor      Boolean                  @default(false)
  isSeriesAInvestor   Boolean                  @default(false)
  investmentNotes     String?
  researchStatus      CoInvestorResearchStatus @default(DRAFT)
  researchNotes       String?
  researchError       String?
  researchUpdatedAt   DateTime?
  createdAt           DateTime                 @default(now())
  updatedAt           DateTime                 @updatedAt

  partners                  CoInvestorPartner[]
  investments               CoInvestorInvestment[]
  researchJobs              CoInvestorResearchJob[]
  companyCoInvestorLinks    CompanyCoInvestorLink[]
  contactLinks              ContactCoInvestor[]
  venturePartners           VenturePartner[]
  interactions              CoInvestorInteraction[]
  nextActions               NextAction[]
  companyFundraiseInvestors CompanyFundraiseInvestor[]

  @@index([name])
  @@index([isSeedInvestor])
  @@index([isSeriesAInvestor])
  @@index([researchStatus])
}

model CoInvestorPartner {
  id           String   @id @default(cuid())
  coInvestorId String
  name         String
  title        String?
  profileUrl   String?
  createdAt    DateTime @default(now())

  coInvestor CoInvestor @relation(fields: [coInvestorId], references: [id], onDelete: Cascade)

  @@index([coInvestorId])
}

model CoInvestorInvestment {
  id                   String    @id @default(cuid())
  coInvestorId         String
  portfolioCompanyName String
  investmentAmountUsd  Decimal?  @db.Decimal(16, 2)
  investmentDate       DateTime?
  investmentStage      String?
  leadPartnerName      String?
  sourceUrl            String?
  createdAt            DateTime  @default(now())

  coInvestor CoInvestor @relation(fields: [coInvestorId], references: [id], onDelete: Cascade)

  @@index([coInvestorId])
  @@index([portfolioCompanyName])
}

model CoInvestorResearchJob {
  id              String                   @id @default(cuid())
  coInvestorId    String
  status          CoInvestorResearchStatus @default(QUEUED)
  searchName      String
  selectedCity    String?
  selectedState   String?
  selectedCountry String?
  selectedWebsite String?
  startedAt       DateTime?
  completedAt     DateTime?
  errorMessage    String?
  createdAt       DateTime                 @default(now())
  updatedAt       DateTime                 @updatedAt

  coInvestor CoInvestor @relation(fields: [coInvestorId], references: [id], onDelete: Cascade)

  @@index([status, createdAt])
  @@index([coInvestorId, createdAt])
}

model CoInvestorInteraction {
  id              String                    @id @default(cuid())
  coInvestorId    String
  interactionType CoInvestorInteractionType @default(NOTE)
  channel         String?
  subject         String?
  summary         String?
  occurredAt      DateTime                  @default(now())
  createdAt       DateTime                  @default(now())
  updatedAt       DateTime                  @updatedAt

  coInvestor CoInvestor @relation(fields: [coInvestorId], references: [id], onDelete: Cascade)

  @@index([coInvestorId, occurredAt])
  @@index([interactionType])
}

model NextAction {
  id           String             @id @default(cuid())
  coInvestorId String
  title        String
  details      String?
  ownerName    String?
  dueAt        DateTime?
  completedAt  DateTime?
  status       NextActionStatus   @default(OPEN)
  priority     NextActionPriority @default(MEDIUM)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt

  coInvestor CoInvestor @relation(fields: [coInvestorId], references: [id], onDelete: Cascade)

  @@index([coInvestorId, status, dueAt])
  @@index([ownerName, status])
}

model Company {
  id                       String                 @id @default(cuid())
  name                     String
  legalName                String?
  website                  String?
  headquartersCity         String?
  headquartersState        String?
  headquartersCountry      String?
  companyType              CompanyType            @default(STARTUP)
  primaryCategory          CompanyPrimaryCategory @default(OTHER)
  primaryCategoryOther     String?
  declineReason            CompanyDeclineReason?
  declineReasonOther       String?
  leadSourceType           CompanyLeadSourceType  @default(OTHER)
  leadSourceHealthSystemId String?
  leadSourceOther          String?
  leadSourceNotes          String?
  description              String?
  atAGlanceProblem         String?
  atAGlanceSolution        String?
  atAGlanceImpact          String?
  atAGlanceKeyStrengths    String?
  atAGlanceKeyConsiderations String?
  googleTranscriptUrl      String?
  spinOutOwnershipPercent  Decimal?               @db.Decimal(7, 2)
  intakeStatus             CompanyIntakeStatus    @default(NOT_SCHEDULED)
  intakeScheduledAt        DateTime?
  screeningEvaluationAt    DateTime?
  researchStatus           ResearchStatus         @default(DRAFT)
  researchNotes            String?
  researchError            String?
  researchUpdatedAt        DateTime?
  createdAt                DateTime               @default(now())
  updatedAt                DateTime               @updatedAt

  leadSourceHealthSystem HealthSystem? @relation("CompanyLeadSourceHealthSystem", fields: [leadSourceHealthSystemId], references: [id], onDelete: SetNull)

  healthSystemLinks             CompanyHealthSystemLink[]
  coInvestorLinks               CompanyCoInvestorLink[]
  contactLinks                  ContactCompany[]
  researchJobs                  CompanyResearchJob[]
  healthSystemInvestments       HealthSystemInvestment[]
  pipeline                      CompanyPipeline?
  documents                     CompanyDocument[]
  opportunities                 CompanyOpportunity[]
  screeningEvents               CompanyScreeningEvent[]
  lois                          CompanyLoi[]
  screeningDocuments            CompanyScreeningDocument[]
  pipelineNotes                 CompanyPipelineNote[]
  screeningQuantitativeFeedback CompanyScreeningQuantitativeFeedback[]
  screeningQualitativeFeedback  CompanyScreeningQualitativeFeedback[]
  screeningCellChanges          CompanyScreeningCellChange[]
  screeningSurveySessions       CompanyScreeningSurveySession[]
  fundraises                    CompanyFundraise[]

  @@index([name])
  @@index([companyType])
  @@index([primaryCategory])
  @@index([leadSourceType])
  @@index([leadSourceHealthSystemId])
  @@index([intakeStatus])
  @@index([researchStatus])
}

model CompanyHealthSystemLink {
  id                  String                          @id @default(cuid())
  companyId           String
  healthSystemId      String
  relationshipType    CompanyHealthSystemRelationship @default(CUSTOMER)
  notes               String?
  investmentAmountUsd Decimal?                        @db.Decimal(16, 2)
  ownershipPercent    Decimal?                        @db.Decimal(7, 2)
  createdAt           DateTime                        @default(now())

  company      Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  healthSystem HealthSystem @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)

  @@index([companyId, healthSystemId])
}

model CompanyCoInvestorLink {
  id                  String                        @id @default(cuid())
  companyId           String
  coInvestorId        String
  relationshipType    CompanyCoInvestorRelationship @default(INVESTOR)
  notes               String?
  investmentAmountUsd Decimal?                      @db.Decimal(16, 2)
  createdAt           DateTime                      @default(now())

  company    Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  coInvestor CoInvestor @relation(fields: [coInvestorId], references: [id], onDelete: Cascade)

  @@index([companyId, coInvestorId])
}

model CompanyResearchJob {
  id              String         @id @default(cuid())
  companyId       String
  status          ResearchStatus @default(QUEUED)
  searchName      String
  selectedCity    String?
  selectedState   String?
  selectedCountry String?
  selectedWebsite String?
  startedAt       DateTime?
  completedAt     DateTime?
  errorMessage    String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([status, createdAt])
  @@index([companyId, createdAt])
}

model CompanyPipeline {
  id                              String                @id @default(cuid())
  companyId                       String                @unique
  phase                           CompanyPipelinePhase  @default(INTAKE)
  intakeDecision                  CompanyIntakeDecision @default(PENDING)
  intakeDecisionAt                DateTime?
  intakeDecisionNotes             String?
  nextStep                        String?
  ventureStudioContractExecutedAt DateTime?
  ventureLikelihoodPercent        Int?
  ventureExpectedCloseDate        DateTime?
  targetLoiCount                  Int                   @default(3)
  s1Invested                      Boolean               @default(false)
  s1InvestmentAt                  DateTime?
  s1InvestmentAmountUsd           Decimal?              @db.Decimal(16, 2)
  portfolioAddedAt                DateTime?
  createdAt                       DateTime              @default(now())
  updatedAt                       DateTime              @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([phase])
}

model CompanyPipelineNote {
  id        String   @id @default(cuid())
  companyId String
  note      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, createdAt])
}

model CompanyDocument {
  id         String              @id @default(cuid())
  companyId  String
  type       CompanyDocumentType @default(OTHER)
  title      String
  url        String
  uploadedAt DateTime            @default(now())
  notes      String?
  createdAt  DateTime            @default(now())

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, type])
}

model EntityDocument {
  id         String     @id @default(cuid())
  entityKind EntityKind
  entityId   String
  title      String
  url        String
  notes      String?
  uploadedAt DateTime   @default(now())
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  noteLinks EntityNoteDocument[]

  @@index([entityKind, entityId, uploadedAt])
  @@index([entityKind, entityId, createdAt])
}

model EntityNote {
  id         String     @id @default(cuid())
  entityKind EntityKind
  entityId   String
  note       String
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  attachments EntityNoteDocument[]

  @@index([entityKind, entityId, createdAt])
}

model EntityNoteDocument {
  noteId     String
  documentId String
  attachedAt DateTime @default(now())

  note     EntityNote     @relation(fields: [noteId], references: [id], onDelete: Cascade)
  document EntityDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@id([noteId, documentId])
  @@index([documentId])
}

model CompanyOpportunity {
  id                 String                  @id @default(cuid())
  companyId          String
  healthSystemId     String?
  type               CompanyOpportunityType
  title              String
  stage              CompanyOpportunityStage @default(IDENTIFIED)
  likelihoodPercent  Int?
  amountUsd          Decimal?                @db.Decimal(16, 2)
  notes              String?
  nextSteps          String?
  estimatedCloseDate DateTime?
  closedAt           DateTime?
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt

  company      Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  healthSystem HealthSystem? @relation(fields: [healthSystemId], references: [id], onDelete: SetNull)

  @@index([companyId, type])
  @@index([healthSystemId])
}

model CompanyScreeningEvent {
  id          String                    @id @default(cuid())
  companyId   String
  type        CompanyScreeningEventType @default(OTHER)
  title       String
  scheduledAt DateTime?
  completedAt DateTime?
  notes       String?
  createdAt   DateTime                  @default(now())
  updatedAt   DateTime                  @updatedAt

  company      Company                       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  participants CompanyScreeningParticipant[]

  @@index([companyId, type])
}

model CompanyScreeningParticipant {
  id               String                           @id @default(cuid())
  screeningEventId String
  healthSystemId   String
  contactId        String?
  attendanceStatus CompanyScreeningAttendanceStatus @default(INVITED)
  notes            String?
  createdAt        DateTime                         @default(now())
  updatedAt        DateTime                         @updatedAt

  screeningEvent CompanyScreeningEvent @relation(fields: [screeningEventId], references: [id], onDelete: Cascade)
  healthSystem   HealthSystem          @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)
  contact        Contact?              @relation(fields: [contactId], references: [id], onDelete: SetNull)

  @@index([screeningEventId, attendanceStatus])
  @@index([healthSystemId])
  @@index([contactId])
}

model CompanyLoi {
  id              String           @id @default(cuid())
  companyId       String
  healthSystemId  String
  status          CompanyLoiStatus @default(NOT_STARTED)
  signedAt        DateTime?
  notes           String?
  statusUpdatedAt DateTime         @default(now())
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  company      Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  healthSystem HealthSystem @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)

  @@unique([companyId, healthSystemId])
  @@index([companyId, status])
}

model CompanyScreeningDocument {
  id             String   @id @default(cuid())
  companyId      String
  healthSystemId String
  title          String
  url            String
  notes          String?
  uploadedAt     DateTime @default(now())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  company      Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  healthSystem HealthSystem @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)

  @@index([companyId, healthSystemId, uploadedAt])
  @@index([healthSystemId])
}

model CompanyScreeningQuantitativeFeedback {
  id             String   @id @default(cuid())
  companyId      String
  healthSystemId String
  contactId      String?
  category       String?
  metric         String
  score          Decimal? @db.Decimal(6, 2)
  weightPercent  Int?
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  company      Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  healthSystem HealthSystem @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)
  contact      Contact?     @relation(fields: [contactId], references: [id], onDelete: SetNull)

  @@index([companyId, healthSystemId, updatedAt])
  @@index([contactId])
}

model CompanyScreeningQualitativeFeedback {
  id             String                            @id @default(cuid())
  companyId      String
  healthSystemId String
  contactId      String?
  category       String?
  theme          String
  sentiment      CompanyScreeningFeedbackSentiment @default(NEUTRAL)
  feedback       String
  createdAt      DateTime                          @default(now())
  updatedAt      DateTime                          @updatedAt

  company      Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  healthSystem HealthSystem @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)
  contact      Contact?     @relation(fields: [contactId], references: [id], onDelete: SetNull)

  @@index([companyId, healthSystemId, updatedAt])
  @@index([contactId])
}

model CompanyScreeningCellChange {
  id              String                    @id @default(cuid())
  companyId       String
  healthSystemId  String
  field           CompanyScreeningCellField
  value           String
  changedByUserId String?
  changedByName   String?
  createdAt       DateTime                  @default(now())

  company       Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  healthSystem  HealthSystem @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)
  changedByUser User?        @relation(fields: [changedByUserId], references: [id], onDelete: SetNull)

  @@index([companyId, healthSystemId, field, createdAt])
  @@index([changedByUserId])
}

model CompanyScreeningSurveyQuestion {
  id              String   @id @default(cuid())
  category        String
  prompt          String
  instructions    String?
  scaleMin        Int      @default(1)
  scaleMax        Int      @default(10)
  isActive        Boolean  @default(true)
  createdByUserId String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  createdByUser    User?                                   @relation(fields: [createdByUserId], references: [id], onDelete: SetNull)
  sessionQuestions CompanyScreeningSurveySessionQuestion[]
  answers          CompanyScreeningSurveyAnswer[]

  @@index([category, isActive])
  @@index([createdByUserId])
}

model CompanyScreeningSurveySession {
  id              String                              @id @default(cuid())
  companyId       String
  title           String
  accessToken     String                              @unique
  status          CompanyScreeningSurveySessionStatus @default(DRAFT)
  openedAt        DateTime?
  closedAt        DateTime?
  createdByUserId String?
  createdAt       DateTime                            @default(now())
  updatedAt       DateTime                            @updatedAt

  company       Company                                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdByUser User?                                   @relation(fields: [createdByUserId], references: [id], onDelete: SetNull)
  questions     CompanyScreeningSurveySessionQuestion[]
  submissions   CompanyScreeningSurveySubmission[]
  answers       CompanyScreeningSurveyAnswer[]

  @@index([companyId, createdAt])
  @@index([status, updatedAt])
  @@index([createdByUserId])
}

model CompanyScreeningSurveySessionQuestion {
  id               String   @id @default(cuid())
  sessionId        String
  questionId       String
  displayOrder     Int      @default(0)
  categoryOverride String?
  promptOverride   String?
  instructionsOverride String?
  createdAt        DateTime @default(now())

  session  CompanyScreeningSurveySession  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  question CompanyScreeningSurveyQuestion @relation(fields: [questionId], references: [id], onDelete: Restrict)
  answers  CompanyScreeningSurveyAnswer[]

  @@unique([sessionId, questionId])
  @@index([sessionId, displayOrder])
  @@index([questionId])
}

model CompanyScreeningSurveySubmission {
  id               String   @id @default(cuid())
  sessionId        String
  healthSystemId   String?
  contactId        String?
  participantName  String?
  participantEmail String?
  submittedAt      DateTime @default(now())
  sourceIpHash     String?
  userAgent        String?

  session      CompanyScreeningSurveySession  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  healthSystem HealthSystem?                  @relation(fields: [healthSystemId], references: [id], onDelete: SetNull)
  contact      Contact?                       @relation(fields: [contactId], references: [id], onDelete: SetNull)
  answers      CompanyScreeningSurveyAnswer[]

  @@index([sessionId, submittedAt])
  @@index([healthSystemId])
  @@index([contactId])
  @@index([participantEmail])
}

model CompanyScreeningSurveyAnswer {
  id                String   @id @default(cuid())
  sessionId         String
  submissionId      String
  sessionQuestionId String
  questionId        String
  score             Int
  createdAt         DateTime @default(now())

  session         CompanyScreeningSurveySession         @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  submission      CompanyScreeningSurveySubmission      @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  sessionQuestion CompanyScreeningSurveySessionQuestion @relation(fields: [sessionQuestionId], references: [id], onDelete: Cascade)
  question        CompanyScreeningSurveyQuestion        @relation(fields: [questionId], references: [id], onDelete: Restrict)

  @@unique([submissionId, sessionQuestionId])
  @@index([sessionId, questionId])
  @@index([sessionQuestionId])
}

model CompanyFundraise {
  id              String                 @id @default(cuid())
  companyId       String
  roundLabel      String
  status          CompanyFundraiseStatus @default(PLANNED)
  totalAmountUsd  Decimal?               @db.Decimal(16, 2)
  s1InvestmentUsd Decimal?               @db.Decimal(16, 2)
  announcedAt     DateTime?
  closedAt        DateTime?
  notes           String?
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt

  company   Company                    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  investors CompanyFundraiseInvestor[]

  @@index([companyId, status])
}

model CompanyFundraiseInvestor {
  id                  String   @id @default(cuid())
  fundraiseId         String
  coInvestorId        String?
  investorName        String
  investmentAmountUsd Decimal? @db.Decimal(16, 2)
  isLeadInvestor      Boolean  @default(false)
  notes               String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  fundraise  CompanyFundraise @relation(fields: [fundraiseId], references: [id], onDelete: Cascade)
  coInvestor CoInvestor?      @relation(fields: [coInvestorId], references: [id], onDelete: SetNull)

  @@index([fundraiseId])
  @@index([coInvestorId])
}

enum ContactRoleType {
  EXECUTIVE
  VENTURE_PARTNER
  INVESTOR_PARTNER
  COMPANY_CONTACT
  OTHER
}

enum UserRole {
  EXECUTIVE
  USER
  ADMINISTRATOR
}

model Contact {
  id          String   @id @default(cuid())
  name        String
  title       String?
  email       String?
  phone       String?
  linkedinUrl String?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  healthSystemLinks                    ContactHealthSystem[]
  companyLinks                         ContactCompany[]
  coInvestorLinks                      ContactCoInvestor[]
  companyScreeningParticipants         CompanyScreeningParticipant[]
  companyScreeningQuantitativeFeedback CompanyScreeningQuantitativeFeedback[]
  companyScreeningQualitativeFeedback  CompanyScreeningQualitativeFeedback[]
  companyScreeningSurveySubmissions    CompanyScreeningSurveySubmission[]

  @@index([name])
  @@index([email])
}

model User {
  id                              String                           @id @default(cuid())
  email                           String                           @unique
  name                            String?
  image                           String?
  isActive                        Boolean                          @default(true)
  googleSub                       String?                          @unique
  lastLoginAt                     DateTime?
  createdAt                       DateTime                         @default(now())
  updatedAt                       DateTime                         @updatedAt
  roles                           UserRoleAssignment[]
  companyScreeningCellChanges     CompanyScreeningCellChange[]
  companyScreeningSurveyQuestions CompanyScreeningSurveyQuestion[]
  companyScreeningSurveySessions  CompanyScreeningSurveySession[]

  @@index([isActive])
}

model UserRoleAssignment {
  id        String   @id @default(cuid())
  userId    String
  role      UserRole
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, role])
  @@index([role])
  @@index([userId])
}

model ContactHealthSystem {
  id             String          @id @default(cuid())
  contactId      String
  healthSystemId String
  roleType       ContactRoleType @default(OTHER)
  title          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  contact      Contact      @relation(fields: [contactId], references: [id], onDelete: Cascade)
  healthSystem HealthSystem @relation(fields: [healthSystemId], references: [id], onDelete: Cascade)

  @@unique([contactId, healthSystemId, roleType])
  @@index([contactId])
  @@index([healthSystemId])
}

model ContactCompany {
  id        String          @id @default(cuid())
  contactId String
  companyId String
  roleType  ContactRoleType @default(COMPANY_CONTACT)
  title     String?
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt

  contact Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([contactId, companyId, roleType])
  @@index([contactId])
  @@index([companyId])
}

model ContactCoInvestor {
  id           String          @id @default(cuid())
  contactId    String
  coInvestorId String
  roleType     ContactRoleType @default(INVESTOR_PARTNER)
  title        String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  contact    Contact    @relation(fields: [contactId], references: [id], onDelete: Cascade)
  coInvestor CoInvestor @relation(fields: [coInvestorId], references: [id], onDelete: Cascade)

  @@unique([contactId, coInvestorId, roleType])
  @@index([contactId])
  @@index([coInvestorId])
}
